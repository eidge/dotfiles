#!/bin/bash
set -e

OS="$(uname -s)"

# Dependencies (common)
COMMON_PKGS="stow zoxide tmux tmuxinator"

if [ "$OS" = "Darwin" ]; then
  brew install $COMMON_PKGS gh nvim asdf rg fd tree-sitter fzf
elif [ "$OS" = "Linux" ]; then
  sudo apt-get update
  sudo apt-get install -y stow $COMMON_PKGS ripgrep fd-find
  mise use -g fzf@latest
fi

# Tmux
[ -d ~/.tmux/plugins/tpm ] || git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm

# macOS-only settings
if [ "$OS" = "Darwin" ]; then
  defaults write com.apple.spaces spans-displays -bool true && killall SystemUIServer
  defaults write com.apple.dock expose-group-apps -bool true && killall Dock

  brew install --cask nikitabobko/tap/aerospace
  brew install --cask obsidian
  brew install --cask ghostty
  brew install --cask keepingyouawake
fi

# Symlink dotfiles
scripts/stow-force
